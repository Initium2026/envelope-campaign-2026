<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>端傳媒新春限定｜春節抽紅包活動</title>
    <style>
        /* --- 視覺基調設定 --- */
        :root {
            --primary-bg: #D0B990;    /* 背景：古銅金 */
            --accent-1: #B09B75;      /* 輔色：深金 */
            --accent-2: #2F4157;      /* 文字/線條：深藍 */
            --gold-1: #2F4157; 
            --gold-2: #EBD8AD;        /* 淺金色 */
            --gold-3: #16202B; 
            --text-color: #2F4157;
            --font-serif: "jf-jinxuan-fresh-2.2", "Songti TC", "Noto Serif TC", "serif";
            --font-sans: "PingFang TC", "Microsoft JhengHei", sans-serif;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            color: var(--text-color); font-family: var(--font-sans);
            overflow: hidden; background-color: var(--primary-bg);
            background-image: 
                radial-gradient(circle at 50% 40%, rgba(255, 255, 255, 0.4) 0%, transparent 70%),
                linear-gradient(180deg, #D0B990 0%, #B09B75 100%);
            background-attachment: fixed;
        }

        .top-logo { position: fixed; top: 24px; left: 24px; z-index: 100; width: 48px; }
        .top-logo img { width: 100%; display: block; filter: brightness(0.2); }

        .container { position: relative; width: 100%; height: 100vh; display: flex; flex-direction: column; overflow-y: auto; scrollbar-width: none; box-sizing: border-box; }
        .container::-webkit-scrollbar { display: none; }

        /* --- 裝飾元素：多層同心圓精緻版 --- */
        .decor { position: fixed; pointer-events: none !important; z-index: 5; }
        .decor-cloud { bottom: 0; left: 0; width: 100%; height: 100px; opacity: 0.3; overflow: visible; }
        .decor-cloud path { stroke: var(--accent-2) !important; }
        
        .decor-cloud-top-new { position: fixed; top: -30px; right: 20px; width: 28vw; max-width: 380px; height: auto; opacity: 0.85; z-index: 6; overflow: visible; }
        .decor-cloud-top-new g, .decor-cloud-top-new path { stroke: var(--accent-2) !important; }

        /* --- 頁面共同樣式 --- */
        .page { display: none; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; text-align: center; min-height: 100%; box-sizing: border-box; z-index: 10; }
        .page.active { display: flex !important; }
        .font-serif { font-family: var(--font-serif); }
        .torn-label { font-size: 1.5rem; letter-spacing: 0.1em; margin-bottom: 2rem; padding: 4px 12px; border-bottom: 2px solid var(--accent-2); opacity: 0.9; }
        h1.main-title { font-size: 2.5rem; font-weight: 700; line-height: 1.5; letter-spacing: 0.25em; color: var(--accent-2); margin: 0; }
        @media (min-width: 768px) { h1.main-title { font-size: 4.5rem; } }
        p.subtitle { font-size: 1.1rem; color: var(--accent-2); margin-top: 3rem; margin-bottom: 40px; letter-spacing: 2px; line-height: 1.8; font-weight: 400; }

        /* --- 按鈕樣式 --- */
        .btn { background: var(--accent-2); border: 1px solid var(--accent-2); color: var(--gold-2); padding: 14px 60px; font-size: 1.1rem; cursor: pointer; border-radius: 50px; transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); text-decoration: none; letter-spacing: 3px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn:hover { background: #16202B; color: #fff; box-shadow: 0 6px 20px rgba(0,0,0,0.4); transform: translateY(-2px); }

        /* --- 第一頁專用：浮動紅包裝飾 --- */
        .promo-envelope { position: absolute; width: 110px; height: 220px; background: linear-gradient(145deg, #A52A2A, #D43F3F); border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 15px 35px rgba(0,0,0,0.2); border-radius: 8px; z-index: 2; overflow: hidden; pointer-events: none; }
        .promo-envelope::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 40%; background: #B22222; clip-path: polygon(0 0, 100% 0, 100% 35%, 50% 100%, 0 35%); z-index: 2; }
        .env-left { left: 8%; top: 35%; animation: envelopeFloatLeft 4.5s ease-in-out infinite; }
        .env-right { right: 8%; top: 35%; animation: envelopeFloatRight 4.5s ease-in-out infinite; animation-delay: -2.25s; }
        @keyframes envelopeFloatLeft { 0%, 100% { transform: translateY(0) rotate(-10deg); } 50% { transform: translateY(-25px) rotate(-13deg); } }
        @keyframes envelopeFloatRight { 0%, 100% { transform: translateY(0) rotate(10deg); } 50% { transform: translateY(-25px) rotate(13deg); } }
        @media (max-width: 900px) { .promo-envelope { display: none; } }

        /* --- 修復：第 2～4 頁選項按鈕樣式 (回歸原始樣貌) --- */
        .question-box { width: 100%; max-width: 800px; margin-top: 30px; }
        #quiz-question-text { line-height: 1.6; max-width: 800px; margin: 0 auto 2rem auto; font-size: 1.5rem; color: var(--accent-2); text-align: center !important; }
        #quiz-options-container { display: flex; flex-direction: column; align-items: center; width: 100%; }
        
        .option {
            display: block; 
            width: 100%; 
            max-width: 500px; 
            background: rgba(47, 65, 87, 0.05); /* 輕微透明底色 */
            border: 1px solid rgba(47, 65, 87, 0.3); /* 原始細邊框 */
            padding: 18px 25px; 
            margin: 12px auto;
            cursor: pointer; 
            transition: all 0.3s ease; 
            border-radius: 4px; 
            text-align: left !important; /* 選項內容文字靠左，如原始截圖 */
            font-size: 1.05rem; 
            color: var(--accent-2);
            box-sizing: border-box;
        }
        .option:hover { 
            background: rgba(47, 65, 87, 0.1); 
            border-color: var(--accent-2); 
        }

        /* --- 第五頁：紅包橫向併排 --- */
        .envelope-container { display: flex !important; flex-direction: row !important; justify-content: center !important; align-items: center !important; gap: 20px !important; height: 380px; width: 100%; position: relative; margin-top: -60px; overflow: visible !important; }
        .envelope-wrapper { position: relative !important; width: 110px !important; height: 230px !important; display: flex !important; justify-content: center !important; align-items: center !important; cursor: pointer; transition: all 0.4s ease; z-index: 10; }
        .envelope { width: 100px !important; height: 220px !important; position: relative; background: linear-gradient(145deg, #A52A2A, #D43F3F); color: #EBD8AD !important; border: 1px solid rgba(255,255,255,0.3) !important; box-shadow: 0 8px 25px rgba(0,0,0,0.3); border-radius: 8px !important; display: flex !important; align-items: center !important; justify-content: center !important; overflow: hidden; }
        .envelope::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 40%; background: #B22222; clip-path: polygon(0 0, 100% 0, 100% 35%, 50% 100%, 0 35%); z-index: 2; }
        .envelope span { margin-top: 85px; z-index: 1; position: relative; writing-mode: vertical-rl; text-orientation: upright; font-size: 1.4rem; letter-spacing: 2px; font-family: var(--font-serif); }
        .envelope-wrapper:hover { z-index: 100 !important; transform: translateY(-30px) scale(1.05) !important; }

        /* --- 第 6 頁：延伸閱讀卡片 (靠左對齊) --- */
        .exhibition-wrapper { display: flex; flex-direction: row; gap: 40px; padding: 0 40px; margin-bottom: 20px; overflow-x: auto; justify-content: center; width: 100%; }
        @media (max-width: 900px) { .exhibition-wrapper { justify-content: flex-start; padding: 0 20px; } }
        .exhibition-item { flex: 0 0 300px; background: rgba(47, 65, 87, 0.05); padding: 0 0 25px 0; border-left: 2px solid var(--accent-2); overflow: hidden; display: flex; flex-direction: column; box-sizing: border-box; z-index: 10; position: relative; text-align: left !important; }
        .exhibition-img { width: calc(100% - 32px); margin: 16px auto 12px auto; height: 160px; object-fit: cover; display: block; border: 0.5px solid var(--accent-2); opacity: 0.9; box-sizing: border-box; }
        .exhibition-item h3 { padding: 0 24px; margin: 0 0 8px 0 !important; color: var(--accent-2); font-size: 1.1rem; text-align: left !important; }
        .exhibition-item p { padding: 0 24px; margin: 0 0 15px 0 !important; font-size: 0.9rem; opacity: 0.8; line-height: 1.6; flex-grow: 1; color: var(--accent-2); text-align: left !important; }
        .exhibition-item .btn { padding: 8px 20px !important; font-size: 0.85rem !important; width: fit-content !important; align-self: flex-start !important; margin-left: 24px !important; border-radius: 50px; background: var(--accent-2) !important; color: #EBD8AD !important; }
        .page#page6 > .btn { margin-top: 15px !important; margin-bottom: 25px !important; padding: 10px 60px !important; position: relative; z-index: 20; line-height: 1.2; }

        /* --- POP-UP 彈窗 --- */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(208, 185, 144, 0.95); justify-content: center; align-items: center; z-index: 10000; backdrop-filter: blur(5px); }
        .popup { background: #fff; padding: 40px 30px; border: 2px solid var(--accent-2); text-align: center; width: 85%; max-width: 420px; color: var(--accent-2); display: flex; flex-direction: column; align-items: center; }
        #result-title { font-size: 2rem; margin: 0 0 15px 0; color: var(--accent-2); letter-spacing: 2px; }
        #result-subtitle { font-size: 1.1rem; margin-bottom: 15px; line-height: 1.5; color: var(--accent-2); font-weight: 500; }
        #result-code { font-family: monospace; font-size: 1rem; color: #A52A2A; border: 1px dashed #A52A2A; padding: 5px 15px; margin-bottom: 25px; letter-spacing: 1px; background: rgba(165, 42, 42, 0.05); }
    </style>
</head>
<body>

    <svg class="decor-cloud-top-new" viewBox="0 0 600 300" fill="none" xmlns="http://www.w3.org/2000/svg" overflow="visible">
        <defs>
            <g id="cloud-unit-fixed">
                <path d="M-50 0 A 50 50 0 0 1 50 0" /><path d="M-38 0 A 38 38 0 0 1 38 0" /><path d="M-26 0 A 26 26 0 0 1 26 0" /><path d="M-14 0 A 14 14 0 0 1 14 0" />
            </g>
        </defs>
        <g transform="translate(10, 20)" stroke="var(--accent-2)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <use href="#cloud-unit-fixed" x="120" y="150" /><use href="#cloud-unit-fixed" x="220" y="150" /><use href="#cloud-unit-fixed" x="320" y="150" />
            <g transform="scale(0.8) translate(650, 185)"><use href="#cloud-unit-fixed" /></g>
            <path d="M20 150 H550 A 17.5 17.5 0 0 1 550 185 H80" /><path d="M80 185 A 17.5 17.5 0 0 0 80 220 H520" />
            <path d="M40 235 H150 A 7.5 7.5 0 0 1 150 250 H120" opacity="0.6" /><path d="M480 250 H560 A 10 10 0 0 0 560 230" opacity="0.6" />
        </g>
    </svg>

    <a href="https://theinitium.com" target="_blank" class="top-logo"><img src="https://theinitium.com/content/images/2026/01/hdd08DDc54kegIlNbgAzfOQUQnjNW11bAafjZAZ6.png" alt="Initium Logo"></a>

    <svg class="decor decor-cloud" viewBox="0 0 1000 100" preserveAspectRatio="xMidYMin slice">
        <defs>
            <g id="wave-unit"><path d="M -40,0 A 40,40 0 0 1 40,0" fill="none" /><path d="M -30,0 A 30,30 0 0 1 30,0" fill="none" /><path d="M -20,0 A 20,20 0 0 1 20,0" fill="none" /><path d="M -10,0 A 10,10 0 0 1 10,0" fill="none" /></g>
            <pattern id="seigaiha-pattern-fixed" x="0" y="0" width="80" height="60" patternUnits="userSpaceOnUse"><g transform="translate(0, 25)"><use href="#wave-unit" x="0" y="60" stroke="var(--accent-2)" stroke-width="1.5" /><use href="#wave-unit" x="80" y="60" stroke="var(--accent-2)" stroke-width="1.5" /><use href="#wave-unit" x="40" y="20" stroke="var(--accent-2)" stroke-width="1.5" /><use href="#wave-unit" x="-40" y="20" stroke="var(--accent-2)" stroke-width="1.5" /></g></pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#seigaiha-pattern-fixed)" />
    </svg>

<div class="container">
    <div id="page1" class="page active">
        <div class="promo-envelope env-left"></div>
        <div class="promo-envelope env-right"></div>
        <div class="torn-label font-serif">端傳媒新春限定</div>
        <h1 class="main-title font-serif">春節抽紅包活動</h1>
        <p class="subtitle">2026/2/13 - 2/22<br>完成 3 題問答，即可獲得 1 次抽獎機會</p>
        <button class="btn" onclick="startChallenge()">立即抽紅包</button>
    </div>

    <div id="quiz-page" class="page">
        <p id="quiz-progress" style="letter-spacing: 3px; opacity: 0.6; font-size: 0.8rem;">QUESTION 01 / 03</p>
        <div class="question-box">
            <h2 id="quiz-question-text" class="font-serif">加載中...</h2>
            <div id="quiz-options-container"></div>
        </div>
    </div>

    <div id="page5" class="page">
        <h1 class="font-serif" style="font-size: 2.2rem; letter-spacing: 4px; color: var(--accent-2);">立即試手氣，選一個紅包</h1>
        <p class="subtitle" style="margin-top: 1rem; margin-bottom: 20px;">新春好禮限量1,000份等你抽，最高抽折抵HK$500端傳媒線上商店免單券</p>
        <div class="envelope-container">
            <div class="envelope-wrapper" onclick="drawPrize()"><div class="envelope"><span>馬上發財</span></div></div>
            <div class="envelope-wrapper" onclick="drawPrize()"><div class="envelope"><span>馬上有錢</span></div></div>
            <div class="envelope-wrapper" onclick="drawPrize()"><div class="envelope"><span>馬上富有</span></div></div>
            <div class="envelope-wrapper" onclick="drawPrize()"><div class="envelope"><span>馬上享受</span></div></div>
            <div class="envelope-wrapper" onclick="drawPrize()"><div class="envelope"><span>馬上快樂</span></div></div>
        </div>
    </div>

    <div id="page6" class="page">
        <h2 class="font-serif" style="color:var(--accent-2); letter-spacing: 2px; margin-bottom: 30px;">延伸閱讀：未完結現場</h2>
        <div class="exhibition-wrapper">
            <div class="exhibition-item">
                <img src="https://theinitium.com/content/images/size/w1280/format/webp/theinitium-com/wp-content/uploads/2025/10/20251030.webp" class="exhibition-img">
                <h3>AI｜與人工智能的日常對話</h3>
                <p>如今，從家用電器到社群貼文排序，人工智能看似無所不在，但它真的改變了我們的生活嗎？</p>
                <a href="https://20260126-unfinished-scene-ai.theinitium.com/?ref=theinitium.com" target="_blank" class="btn">前往專題</a>
            </div>
            <div class="exhibition-item">
                <img src="https://theinitium.com/content/images/size/w1280/format/webp/theinitium-com/wp-content/uploads/2023/09/010fd3f9d0284e49a0861a54d1da2f27.jpg" class="exhibition-img">
                <h3>地緣政治｜斷層線上的新日常</h3>
                <p>台海的緊張、中東的戰火、格陵蘭的爭奪——遠方的衝突越海而至，軍備強化、不安疊加，民族主義依然炙熱；世界秩序，進入重組時間。</p>
                <a href="https://20260126-unfinished-scene-geo-politics.theinitium.com/?ref=theinitium.com" target="_blank" class="btn">前往專題</a>
            </div>
            <div class="exhibition-item">
                <img src="https://theinitium.com/content/images/size/w1280/format/webp/2025/12/_CT_8344.jpg" class="exhibition-img">
                <h3>香港世紀大火｜大火熄滅後</h3>
                <p>熱點過後，宏福苑大火的前因與後遺，仍待被挖掘。</p>
                <a href="https://20260126-unfinished-scene-taipo-megafire.theinitium.com/?ref=theinitium.com" target="_blank" class="btn">前往專題</a>
            </div>
        </div>
        <button class="btn" onclick="location.reload()">返回首頁</button>
    </div>
</div>

<div id="overlay" class="overlay">
    <div class="popup">
        <h2 id="result-title" class="font-serif"></h2>
        <div id="result-subtitle"></div>
        <div id="result-code"></div>
        <button class="btn" onclick="switchPage('page6'); document.getElementById('overlay').style.display='none';">瀏覽專題</button>
    </div>
</div>

<script>
    const quizData = [
        { "q": "哪一位不是端傳媒「未完結現場」計畫的共同策展人？", "a": ["記者吳政霆", "編輯許伯崧", "編輯李慧筠", "以上皆是"], "correct": 3 },
        { "q": "以下對於端傳媒的敘述，哪一個不是正確的？", "a": ["邁向成立第11年", "端的讀者遍布全球100+個國家與地區", "2025年榮獲29項新聞獎", "以上皆是"], "correct": 3 },
        { "q": "2026年歲次是什麼？", "a": ["龍年", "蛇年", "馬年", "羊年"], "correct": 2 }
    ];

/* --- 1. 設定獎品與數量 (總數 1000 份) --- */
    const prizeConfig = [
        { id: 1, count: 10,  title: "｜金馬獎｜", subtitle: "線上商店免單券（最高折 HK$500）", code: "EOFWEJ68" },
        { id: 2, count: 40,  title: "｜金喜獎｜", subtitle: "線上商店全單 8 折券（最高折 HK$300）", code: "EOFWEJ68" },
        { id: 3, count: 50,  title: "｜金春獎｜", subtitle: "線上商店 HK$200 折價券", code: "EOFWEJ68" },
        { id: 4, count: 150, title: "｜好運獎｜", subtitle: "線上商店 9 折券", code: "EOFWEJ68" },
        { id: 5, count: 700, title: "｜隨喜獎｜", subtitle: "線上商店 95 折券", code: "EOFWEJ68" },
        { id: 6, count: 50,  title: "｜開春獎｜", subtitle: "線上商店 HK$80折價券<br>（消費滿HK$400 才能使用）", code: "EOFWEJ68" }
    ];

    /* --- 2. 建立抽獎池 (自動計算：1000 份獎品 + 10000 份未中獎) --- */
    let prizePool = [];
    
    // (A) 放入中獎籤
    prizeConfig.forEach(p => { 
        for(let i=0; i < p.count; i++) { 
            prizePool.push(p); 
        } 
    });

    // (B) 放入未中獎籤 (獎品總數的 10 倍)
    const noWinPrize = { title: "｜未中獎｜", subtitle: "沒中獎別灰心！<br>端傳媒祝你新年快樂！", code: "" };
    const totalPrizes = 1000;
    const noWinCount = totalPrizes * 10; 

    for(let i=0; i < noWinCount; i++) { 
        prizePool.push(noWinPrize); 
    }

    /* --- 3. 抽獎執行函式 (包含卡控與彈窗) --- */
    function drawPrize() {
        // 檢查是否已抽過 (localStorage)
        if (localStorage.getItem('drawn_prize_2026')) {
            showAlreadyPlayedPopup(); // 之前可能缺少這個函式導致沒反應
            return;
        }

        // 隨機抽選
        const win = prizePool[Math.floor(Math.random() * prizePool.length)];

        // 填入資料
        document.getElementById('result-title').innerText = win.title;
        document.getElementById('result-subtitle').innerHTML = win.subtitle;
        
        const codeElem = document.getElementById('result-code');
        if(win.code) { 
            codeElem.innerText = win.code; 
            codeElem.style.display = 'block'; 
        } else { 
            codeElem.style.display = 'none'; 
        }
        
        // 寫入已抽過紀錄
        localStorage.setItem('drawn_prize_2026', 'true');
        
        // 顯示彈窗
        document.getElementById('overlay').style.display = 'flex';
    }

    /* --- 4. 顯示「已抽過」提示彈窗 (這是修復關鍵) --- */
    function showAlreadyPlayedPopup() {
        document.getElementById('result-title').innerText = "提示";
        document.getElementById('result-subtitle').innerText = "每人限參加一次，您已經領取過紅包囉！";
        document.getElementById('result-code').style.display = 'none';
        
        // 確保按鈕文字正確
        const btn = document.querySelector('#overlay .btn');
        if(btn) btn.innerText = "前往專題";
        
        document.getElementById('overlay').style.display = 'flex';
    }

    let currentQuestions = []; let currentStep = 0;
    function switchPage(pageId) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); const target = document.getElementById(pageId); if(target) target.classList.add('active'); document.querySelector('.container').scrollTop = 0; }
    function startChallenge() { currentQuestions = [...quizData]; currentStep = 0; renderQuiz(); switchPage('quiz-page'); }
    function renderQuiz() {
        const data = currentQuestions[currentStep];
        document.getElementById('quiz-progress').innerText = `QUESTION 0${currentStep + 1} / 03`;
        document.getElementById('quiz-question-text').innerHTML = data.q; 
        const container = document.getElementById('quiz-options-container'); container.innerHTML = '';
        data.a.forEach((optionText, index) => {
            const div = document.createElement('div'); div.className = 'option'; div.innerText = `${String.fromCharCode(65 + index)}. ${optionText}`; div.onclick = () => handleAnswer(div, index, data.correct); container.appendChild(div);
        });
    }
    function handleAnswer(element, selectedIdx, correctIdx) {
        const allOptions = element.parentElement.querySelectorAll('.option');
        allOptions.forEach(opt => opt.style.pointerEvents = 'none');
        if (selectedIdx === correctIdx) element.style.background = "rgba(76, 175, 80, 0.2)";
        else element.style.background = "rgba(244, 67, 54, 0.2)";
        setTimeout(() => { if (currentStep < 2) { currentStep++; renderQuiz(); } else { switchPage('page5'); } }, 1000);
    }
</script>
</body>
</html>
